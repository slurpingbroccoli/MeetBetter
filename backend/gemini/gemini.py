from google import genai
from dotenv import load_dotenv
import os

load_dotenv()

def extract_relevant_info(profile: dict) -> dict:
    """
    Extract only the relevant information from a LinkedIn profile for matching.
    
    Args:
        profile: Full LinkedIn profile dictionary
    
    Returns:
        Dictionary with only relevant fields
    """
    sections = profile.get('sections', {})
    
    return {
        'name': profile.get('name', ''),
        'headline': profile.get('headline', ''),
        'location': profile.get('location', ''),
        'about': sections.get('about', {}).get('text', ''),
        'experience': sections.get('experience', {}).get('text', ''),
        'education': sections.get('education', {}).get('text', ''),
        'skills': sections.get('skills', {}).get('text', ''),
        'projects': sections.get('projects', {}).get('text', ''),
        'interests': sections.get('interests', {}).get('text', ''),
    }


def generate_conversation_starters(my_info: dict, other_person_info: dict) -> str:
    """
    Generate 3 conversation starter questions based on shared interests between two LinkedIn profiles.
    
    Args:
        my_info: Dictionary containing your LinkedIn profile information
        other_person_info: Dictionary containing the other person's LinkedIn profile information
    
    Returns:
        String containing 3 conversation starter questions
    """
    client = genai.Client(api_key=os.environ.get("GEMINI_API_KEY"))
    
    # Extract only relevant information
    my_relevant = extract_relevant_info(my_info)
    other_relevant = extract_relevant_info(other_person_info)
    
    prompt = f"""Based on these two LinkedIn profiles, generate 3 coffee chat questions that highlight shared interests or experiences.

Person 1: {my_relevant['name']}
- Headline: {my_relevant['headline']}
- About: {my_relevant['about'][:200]}
- Experience: {my_relevant['experience'][:300]}
- Education: {my_relevant['education'][:200]}
- Interests: {my_relevant['interests'][:200]}

Person 2: {other_relevant['name']}
- Headline: {other_relevant['headline']}
- About: {other_relevant['about'][:200]}
- Experience: {other_relevant['experience'][:300]}
- Education: {other_relevant['education'][:200]}
- Interests: {other_relevant['interests'][:200]}

Generate 3 conversation starter questions that match interests between these two people."""
    
    response = client.models.generate_content(
        model="gemini-2.5-flash",
        contents=prompt
    )
    
    return response.text


# Example usage:
if __name__ == "__main__":
    other_guy = """
        {'headline': 'Software Engineering Graduate | MacEng Alum', 'location': 'Toronto, Ontario, Canada', 'name': 'Aniket Kabra', 'sections': {'about': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'My portfolio at a glance: https://aniketkabra.me/ I am an aspiring Software Engineer, with a keen interest in the field of Computer Science and everything it entails. My main interests are focused on Backend Development, Database Management, and Data Science using Artificial Intelligence. I am an avid learner, and strongly believe that learning is a continuous process. On that account, the ever-growing nature of the fields of software and computer science allows one to always widen their technical avenue with something new to learn and practice. I aspire to learn more, and I am more than excited to see where this journey takes me.'}, 'activity': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': '1,368 followers 1,368 followers Loaded 1 Comments post Aniket Kabra commented on a post ‚Ä¢ 2mo 2mo Congrats Ellie! Congrats Ellie! Show all comments'}, 'education': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'McMaster University McMaster University Bachelor of Engineering - BE, Computer Software Engineering Bachelor of Engineering - BE, Computer Software Engineering 2019 - 2024 2019 - 2024\n---\nDPS Modern Indian School, Doha, Qatar DPS Modern Indian School, Doha, Qatar DPS Modern Indian School, Doha, Qatar High School, Computer Science High School, Computer Science 2015 - 2019 2015 - 2019'}, 'experience': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Associate Developer Associate Developer IBM ¬∑ Permanent Full-time IBM ¬∑ Permanent Full-time Aug 2024 - Present ¬∑ 1 yr 6 mos Aug 2024 to Present ¬∑ 1 yr 6 mos Toronto, Ontario, Canada Toronto, Ontario, Canada\n---\nSoftware Developer Intern Software Developer Intern DRW ¬∑ Internship DRW ¬∑ Internship May 2023 - Aug 2023 ¬∑ 4 mos May 2023 to Aug 2023 ¬∑ 4 mos Montreal, Quebec, Canada ¬∑ On-site Montreal, Quebec, Canada ¬∑ On-site\n---\nJr. Software Engineer Intern Jr. Software Engineer Intern Tucows ¬∑ Co-op Tucows ¬∑ Co-op May 2022 - Apr 2023 ¬∑ 1 yr May 2022 to Apr 2023 ¬∑ 1 yr Toronto, Ontario, Canada Toronto, Ontario, Canada PostgreSQL, Nomad and +5 skills\n---\nTeaching Assistant - SFWR 2DA4 & SFWR 2GA3 Teaching Assistant - SFWR 2DA4 & SFWR 2GA3 Faculty of Engineering - McMaster University Faculty of Engineering - McMaster University Jan 2022 - Apr 2023 ¬∑ 1 yr 4 mos Jan 2022 to Apr 2023 ¬∑ 1 yr 4 mos Hamilton, Ontario, Canada Hamilton, Ontario, Canada Helping in the running of the Digital Architecture I and II courses, by teaching and marking for over 200 software engineering students Helping in the running of the Digital Architecture I and II courses, by teaching and marking for over 200 software engineering students Field-Programmable Gate Arrays (FPGA) and Verilog\n---\nTechnical Systems Analyst Intern Technical Systems Analyst Intern RBC ¬∑ Co-op RBC ¬∑ Co-op May 2021 - Aug 2021 ¬∑ 4 mos May 2021 to Aug 2021 ¬∑ 4 mos Toronto, Ontario, Canada Toronto, Ontario, Canada - Worked with the Bulk Payments team under Technology & Operations. - Created a standalone Springboot application that uses REST APIs to connect to a SQL database for future application migrations. - Hands-on experience with pipelining, deployment, and cloud platforms ‚Äì Jenkins, Helios, UrbanCode Deploy, and Private Cloud Foundry. - Worked with the Bulk Payments team under Technology & Operations. - Created a standalone Springboot application that uses REST APIs to connect to a SQL database for future application migrations. - Hands-on experience with pipelining, deployment, and cloud platforms ‚Äì Jenkins, Helios, UrbanCode Deploy, and Private Cloud Foundry. ‚Ä¶see more'}, 'explore premium profiles': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'HBSc Candidate at the University of Toronto'}, 'honors & awards': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'An award worth $2500 for displaying academic excellence in high school (>95%).'}, 'interests': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Richard Branson Richard Branson Founder at Virgin Group Founder at Virgin Group 18,664,106 followers 18,664,106 followers Follow\n---\nIBM IBM 19,090,217 followers19,090,217 followers Follow\n---\nMicrosoft Microsoft 27,287,866 followers27,287,866 followers Follow\n---\nIn the LoopIn the Loop A Newsletter highlighting trending topics, conversations and tools to help navigate the changing world of work.A Newsletter highlighting trending topics, conversations and tools to help navigate the changing world of work. Published biweeklyPublished biweekly LinkedIn LinkedIn Subscribe\n---\nStories From The HerdStories From The Herd The Stories from the Herd are a series of learnings, sharings, and insights prepared by our talented herd members.The Stories from the Herd are a series of learnings, sharings, and insights prepared by our talented herd members. Published monthlyPublished monthly Tucows Tucows Subscribe\n---\nMcMaster UniversityMcMaster University 299,554 followers299,554 followers Follow\n---\nFaculty of Engineering - McMaster UniversityFaculty of Engineering - McMaster University 21,816 followers21,816 followers Follow'}, 'languages': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'English English Native or bilingual proficiency Native or bilingual proficiency\n---\nHindi Hindi Native or bilingual proficiency Native or bilingual proficiency'}, 'licenses & certifications': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Microsoft Certified: Azure Data Fundamentals Microsoft Certified: Azure Data Fundamentals Microsoft Microsoft Issued Sep 2024 Issued Sep 2024 Credential ID 236F6C597406484B Credential ID 236F6C597406484B Show credential\n---\nMicrosoft Certified: Azure Fundamentals Microsoft Certified: Azure Fundamentals Microsoft Microsoft Issued Sep 2024 Issued Sep 2024 Credential ID EEFDACECB1B120BA Credential ID EEFDACECB1B120BA Show credential Microsoft Azure'}, 'more profiles for you': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Software Engineer @ Carta | Software Engineering UWaterloo Alumni'}, 'people you may know': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Computer Science (Co-op) @ University of Toronto | Research @ RiskLab | Prev. SWE @ Ontario Public Service, Founding Engineer @ Wealthseed | 2x Hackathon Winner'}, 'projects': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Image Classifier Image Classifier Jan 2020 - Jan 2020 Jan 2020 - Jan 2020 Show project Developed a model using deep learning concepts and trained it using Keras to identify seas, mountains, glaciers, forests, streets, and buildings from their respective images. Developed a model using deep learning concepts and trained it using Keras to identify seas, mountains, glaciers, forests, streets, and buildings from their respective images.\n---\nWind-House Simulation Wind-House Simulation Nov 2019 - Nov 2019 Nov 2019 - Nov 2019 Associated with McMaster University Associated with McMaster University - Built a low-fidelity prototype of a house that could withstand strong winds without falling over at the McMaster Engineering Competition. - The prototype modeled a real-world scenario where a house would be built on unsteady land. - Built a low-fidelity prototype of a house that could withstand strong winds without falling over at the McMaster Engineering Competition. - The prototype modeled a real-world scenario where a house would be built on unsteady land.'}, 'recommendations': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Aniket joined our team as an RBC Summer co-op student. He is a quick learner, team player and a great person to work with. Aniket was always eager to learn new tools and technology. He was able to quickly learn spring boot and start working on our existing application to make changes. Always admired his calm and cool attitude towards the work assigned to him. Keep up the good work.'}, 'skills': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Microsoft Certified: Azure Fundamentals'}, 'volunteering': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': '- Worked on Connect2: a web-app that helps students connect with their peers based on the courses they take and their personality types. - Learned how to use the Google Cloud Platform, Firebase, and React.js.'}, 'you might like': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Government Administration'}}}"""
    
    my_info = """
        {'headline': 'Computer Science @ UofT ‚Äò29', 'location': 'Markham, Ontario, Canada', 'name': 'Edison Cai', 'sections': {'about': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'I do stuff'}, 'activity': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': '#'}, 'analytics': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': "119 profile views 119 profile views Discover who's viewed your profile. Discover who's viewed your profile.\n---\n159 post impressions 159 post impressions Check out who's engaging with your posts. Check out who's engaging with your posts. Past 7 days Past 7 days\n---\n26 search appearances 26 search appearances See how often you appear in search results. See how often you appear in search results."}, 'education': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'University of Toronto University of Toronto Bachelor of Science - BS, Computer Science Bachelor of Science - BS, Computer Science'}, 'experience': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Vice President Vice President UHS Computer Science Club ¬∑ Seasonal UHS Computer Science Club ¬∑ Seasonal Mar 2024 - Jun 2025 ¬∑ 1 yr 4 mos Mar 2024 to Jun 2025 ¬∑ 1 yr 4 mos On-site On-site\n---\nSoftware Engineer Software Engineer bizZone Inc. ¬∑ Internship bizZone Inc. ¬∑ Internship Oct 2024 - Mar 2025 ¬∑ 6 mos Oct 2024 to Mar 2025 ¬∑ 6 mos Markham, Ontario, Canada ¬∑ Remote Markham, Ontario, Canada ¬∑ Remote\n---\nFounder Founder UHS GDevelop Team UHS GDevelop Team Jun 2023 - Mar 2025 ¬∑ 1 yr 10 mos Jun 2023 to Mar 2025 ¬∑ 1 yr 10 mos On-site On-site Founded and organized a Student-Led STEM Workshop for Grade 8 students to introduce them to programming, game development, and STEM through GDevelop. Hosted workshops to over 150 students. Worked with groups of students to build and develop their own custom games. Founded and organized a Student-Led STEM Workshop for Grade 8 students to introduce them to programming, game development, and STEM through GDevelop. Hosted workshops to over 150 students. Worked with groups of students to build and develop their own custom games. ‚Ä¶see more\n---\nToronto Chinese Soccer Association (TCSA) Toronto Chinese Soccer Association (TCSA) Seasonal ¬∑ 2 yrs 3 mos Seasonal ¬∑ 2 yrs 3 mos Social Media Manager Social Media Manager Jun 2024 - Sep 2024 ¬∑ 4 mos Jun 2024 to Sep 2024 ¬∑ 4 mos Hybrid Hybrid Certification of Appreciation Certification of Appreciation Assistant Soccer Coach Assistant Soccer Coach Jul 2022 - Jun 2024 ¬∑ 2 yrs Jul 2022 to Jun 2024 ¬∑ 2 yrs Toronto, Ontario, Canada ¬∑ On-site Toronto, Ontario, Canada ¬∑ On-site'}, 'featured': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': '#'}, 'interests': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'LinkedIn LinkedIn 32,739,226 followers 32,739,226 followers Following\n---\nUniversity of Toronto University of Toronto 905,187 followers 905,187 followers Following\n---\nDepartment of Computer Science, University of TorontoDepartment of Computer Science, University of Toronto 10,338 followers10,338 followers Following\n---\nUniversity of TorontoUniversity of Toronto 905,187 followers905,187 followers Following'}, 'people you may know': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Student'}, 'projects': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Wolfpackapp - iOS Application Wolfpackapp - iOS Application Mar 2024 - Feb 2025 Mar 2024 - Feb 2025 Associated with UHS Computer Science Club Associated with UHS Computer Science Club For all things Unionville and YRDSB üê∫üéì Introducing the new Wolfpackapp üê∫: The app that ensures your success as a YRDSB student üéì. Its clean and user-friendly UI is perfect for anyone, anywhere. ‚ú® Fully integrated with TeachAssist, you can stay on track with your performance through up-to-date, accurate marks üìà. With the precise and reliable assignment editor, manage your future marks IN REAL TIME. The wolfpackapp allows students to schedule GUIDANCE APPOINTMENTS from the palm of their hand üìÜ. Always know when your next appointment is with our new GUIDANCE APPOINTMENT SCHEDULE. Booking a time with your guidance counsellor has never been easier! Need to email a teacher üßë\u200düè´? The wolfpackapp contains the largest database of over 200+ teachers across YRDSB. For all things Unionville and YRDSB üê∫üéì Introducing the new Wolfpackapp üê∫: The app that ensures your success as a YRDSB student üéì. Its clean and user-friendly UI is perfect for anyone, anywhere. ‚ú® Fully integrated with TeachAssist, you can stay on track with your performance through up-to-date, accurate marks üìà. With the precise and reliable assignment editor, manage your future marks IN REAL TIME. The wolfpackapp allows students to schedule GUIDANCE APPOINTMENTS from the palm of their hand üìÜ. Always know when your next appointment is with our new GUIDANCE APPOINTMENT SCHEDULE. Booking a time with your guidance counsellor has never been easier! Need to email a teacher üßë\u200düè´? The wolfpackapp contains the largest database of over 200+ teachers across YRDSB. ‚Ä¶see more Other contributors Other contributors'}, 'skills': {'class': 'artdeco-card pv-profile-card break-words\n            \n            pv-profile-card--null-state\n            \n            mt2', 'text': 'Soft skills Soft skills\n---\nTechnical skills Technical skills'}, 'who your viewers also viewed': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Someone at University of Waterloo Someone at University of Waterloo View\n---\nStudent at Vision and Image Processing‚Ä¶ Student at Vision and Image Processing‚Ä¶ View\n---\nSomeone at Flybits Someone at Flybits View\n---\nSomeone at McMaster University Someone at McMaster University View'}, 'you might like': {'class': 'artdeco-card pv-profile-card break-words\n            \n            \n            \n            mt2', 'text': 'Computer Games'}}}"""
    
    # Generate conversation starters
    starters = generate_conversation_starters(my_info, other_guy)
    print(starters)